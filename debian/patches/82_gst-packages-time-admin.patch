Description: Install ntp package on demand
Author: ?

---
 src/time/time-tool.c |   18 +++++++++++++++++-
 1 file changed, 17 insertions(+), 1 deletion(-)

--- a/src/time/time-tool.c
+++ b/src/time/time-tool.c
@@ -370,6 +370,7 @@ check_ntp_support (GstTool  *tool)
 {
 	GstTimeToolPrivate *priv = GST_TIME_TOOL_GET_PRIVATE (tool);
 	GtkWidget *message, *widget;
+	gint response;
 
 	if (GST_TIME_TOOL (tool)->ntp_service)
 		return TRUE;
@@ -396,9 +397,24 @@ check_ntp_support (GstTool  *tool)
 						  _("Please install and activate NTP support in the system to enable "
 						    "synchronization of your local time server with "
 						    "internet time servers."));
-	gtk_dialog_run (GTK_DIALOG (message));
+
+	gtk_dialog_add_button (GTK_DIALOG (message), _("Install NTP support"), GTK_RESPONSE_OK);
+	response = gtk_dialog_run (GTK_DIALOG (message));
 	gtk_widget_destroy (message);
 
+	if (response == GTK_RESPONSE_OK) {
+		const gchar *packages[] = { "ntp", NULL };
+
+		if (gst_packages_install (GTK_WINDOW (tool->main_dialog), packages)) {
+			gtk_combo_box_set_active (GTK_COMBO_BOX (widget), CONFIGURATION_AUTOMATIC);
+			gst_tool_update_config (tool);
+			gst_tool_update_gui (tool);
+
+			if (GST_TIME_TOOL (tool)->ntp_service)
+				return TRUE;
+		}
+	}
+
 	return FALSE;
 }
 
